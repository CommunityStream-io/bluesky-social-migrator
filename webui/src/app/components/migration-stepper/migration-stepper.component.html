<div class="migration-stepper-container">
  <!-- Header with progress -->
  <mat-card class="stepper-header">
    <div class="header-content">
      <h1>Instagram to Bluesky Migration</h1>
      <p class="subtitle">Migrate your Instagram content to Bluesky in 5 simple steps</p>
      
             <!-- Overall progress bar -->
       <div class="overall-progress">
         <div class="progress-label">
           <span>Overall Progress</span>
           <span class="progress-percentage">{{ getOverallProgress() | number:'1.0-0' }}%</span>
         </div>
         <mat-progress-bar 
           [value]="getOverallProgress()" 
           [color]="getOverallProgress() === 100 ? 'accent' : 'primary'">
         </mat-progress-bar>
       </div>
       
       <!-- Feedback button -->
       <div class="feedback-section">
         <button 
           mat-button 
           color="accent"
           (click)="openFeedback()"
           class="feedback-button">
           <mat-icon>feedback</mat-icon>
           Send Feedback
         </button>
       </div>
    </div>
  </mat-card>

  <!-- Performance Monitor (Development Only) -->
  <app-performance-monitor *ngIf="showPerformanceMonitor"></app-performance-monitor>

  <!-- Main stepper -->
  <mat-stepper 
    #stepper 
    [linear]="true" 
    [selectedIndex]="currentStepIndex"
    class="migration-stepper">
    
    <!-- Step 1: Content Upload -->
    <mat-step 
      [completed]="getCurrentStep()?.completed">
      <ng-template matStepLabel>
        <div class="step-label">
          <mat-icon>cloud_upload</mat-icon>
          <span>Content Upload</span>
        </div>
      </ng-template>
      <ng-template matStepContent>
        <app-content-upload 
          (stepCompleted)="onStepCompleted(0)">
        </app-content-upload>
      </ng-template>
    </mat-step>

    <!-- Step 2: Bluesky Authentication -->
    <mat-step 
      [completed]="getCurrentStep()?.completed">
      <ng-template matStepLabel>
        <div class="step-label">
          <mat-icon>account_circle</mat-icon>
          <span>Bluesky Authentication</span>
        </div>
      </ng-template>
      <ng-template matStepContent>
        <app-bluesky-auth 
          (stepCompleted)="onStepCompleted(1)">
        </app-bluesky-auth>
      </ng-template>
    </mat-step>

    <!-- Step 3: Migration Configuration -->
    <mat-step 
      [completed]="getCurrentStep()?.completed">
      <ng-template matStepLabel>
        <div class="step-label">
          <mat-icon>settings</mat-icon>
          <span>Migration Configuration</span>
        </div>
      </ng-template>
      <ng-template matStepContent>
        <app-migration-config 
          (stepCompleted)="onStepCompleted(2)">
        </app-migration-config>
      </ng-template>
    </mat-step>

    <!-- Step 4: Migration Execution -->
    <mat-step 
      [completed]="getCurrentStep()?.completed">
      <ng-template matStepLabel>
        <div class="step-label">
          <mat-icon>sync</mat-icon>
          <span>Migration Execution</span>
        </div>
      </ng-template>
      <ng-template matStepContent>
        <app-migration-execution 
          (stepCompleted)="onStepCompleted(3)">
        </app-migration-execution>
      </ng-template>
    </mat-step>

    <!-- Step 5: Completion -->
    <mat-step 
      [completed]="getCurrentStep()?.completed">
      <ng-template matStepLabel>
        <div class="step-label">
          <mat-icon>check_circle</mat-icon>
          <span>Completion</span>
        </div>
      </ng-template>
      <ng-template matStepContent>
        <app-completion 
          (stepCompleted)="onStepCompleted(4)">
        </app-completion>
      </ng-template>
    </mat-step>
  </mat-stepper>

  <!-- Navigation buttons -->
  <div class="stepper-navigation">
    <button 
      mat-button 
      (click)="previousStep()" 
      [disabled]="!canGoBack || isLoading"
      class="nav-button">
      <mat-icon>arrow_back</mat-icon>
      Previous
    </button>
    
    <button 
      mat-raised-button 
      color="primary" 
      (click)="nextStep()" 
      [disabled]="!canProceed || isLoading"
      class="nav-button">
      <mat-icon *ngIf="!isLoading">arrow_forward</mat-icon>
      <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
      {{ isLoading ? 'Loading...' : 'Next' }}
    </button>
  </div>

  <!-- Performance Toggle Button (Development Only) -->
  <div class="performance-toggle">
    <button 
      mat-button 
      (click)="togglePerformanceMonitor()"
      class="toggle-button">
      <mat-icon>{{ showPerformanceMonitor ? 'visibility_off' : 'visibility' }}</mat-icon>
      {{ showPerformanceMonitor ? 'Hide' : 'Show' }} Performance Monitor
    </button>
  </div>
</div>
